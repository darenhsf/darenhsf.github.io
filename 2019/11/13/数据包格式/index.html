<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>数据包格式总结 | Angrily bullfighting</title><meta name="author" content="Daren"><meta name="copyright" content="Daren"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="数据包格式总结  网络数据封装数据链路层对应的数据为帧 Frame，网络层对应的数据为包 Packet，传输层对应的数据为数据段 Segment。 数据封装 1.网络数据首先会打到传输层对应的Segment中， 2.然后会打到网络层的Packet中， 3.然后再打到以太网Ethernet的Frame中，">
<meta property="og:type" content="article">
<meta property="og:title" content="数据包格式总结">
<meta property="og:url" content="http://darenhsf.github.io/2019/11/13/%E6%95%B0%E6%8D%AE%E5%8C%85%E6%A0%BC%E5%BC%8F/index.html">
<meta property="og:site_name" content="Angrily bullfighting">
<meta property="og:description" content="数据包格式总结  网络数据封装数据链路层对应的数据为帧 Frame，网络层对应的数据为包 Packet，传输层对应的数据为数据段 Segment。 数据封装 1.网络数据首先会打到传输层对应的Segment中， 2.然后会打到网络层的Packet中， 3.然后再打到以太网Ethernet的Frame中，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2019-11-13T05:00:48.000Z">
<meta property="article:modified_time" content="2021-10-15T03:38:27.249Z">
<meta property="article:author" content="Daren">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://darenhsf.github.io/2019/11/13/%E6%95%B0%E6%8D%AE%E5%8C%85%E6%A0%BC%E5%BC%8F/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '数据包格式总结',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-10-15 11:38:27'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">91</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Angrily bullfighting</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">数据包格式总结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-11-13T05:00:48.000Z" title="发表于 2019-11-13 13:00:48">2019-11-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-10-15T03:38:27.249Z" title="更新于 2021-10-15 11:38:27">2021-10-15</time></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>数据包格式总结</p>
</blockquote>
<h1 id="网络数据封装"><a href="#网络数据封装" class="headerlink" title="网络数据封装"></a>网络数据封装</h1><p><code>数据链路层</code>对应的数据为<code>帧 Frame</code>，<code>网络层</code>对应的数据为<code>包 Packet</code>，传输层对应的数据为<code>数据段 Segment</code>。</p>
<p>数据封装</p>
<p>1.<code>网络数据</code>首先会打到<code>传输层对应的Segmen</code>t中，</p>
<p>2.然后会打到<code>网络层的Packet</code>中，</p>
<p>3.然后再打到<code>以太网Ethernet的Frame</code>中，</p>
<span id="more"></span>

<p>传到对端后，各个层解析自己的协议，然后把数据交给更高层的协议处理。</p>
<blockquote>
<p>从数据封装的角度来说，ARP和RARP应该都是属于网络层的协议</p>
</blockquote>
<ul>
<li>传输层<ul>
<li>TCP</li>
<li>UDP</li>
</ul>
</li>
<li>网络层<ul>
<li>IP</li>
<li>ICMP</li>
<li>ARP</li>
</ul>
</li>
<li>数据链路层<ul>
<li>以太网帧</li>
<li>802.11帧</li>
</ul>
</li>
</ul>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zNC41MWN0by5jb20vaW1hZ2VzL2Jsb2cvMjAxODAxLzE0LzUwZmVkZWY5YTE3NDg5NzM0M2YxZThhY2MyZDVlOGI3LnBuZw?x-oss-process=image/format,png" alt="img"></p>
<h1 id="各层封装格式"><a href="#各层封装格式" class="headerlink" title="各层封装格式"></a>各层封装格式</h1><h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><p>TCP 报文是 TCP 层传输的数据单元，也称为报文段。</p>
<p><img src="http://c.biancheng.net/uploads/allimg/191108/6-19110Q62344I5.gif" alt="img"></p>
<p>上图中 TCP 报文中每个字段的含义如下：</p>
<ul>
<li><p>源端口和目的端口字段</p>
<ul>
<li>TCP源端口（Source Port）：源计算机上的应用程序的端口号，占 16 位。</li>
<li>TCP目的端口（Destination Port）：目标计算机的应用程序端口号，占 16 位。</li>
</ul>
</li>
<li><p>序列号字段</p>
</li>
</ul>
<p>CP序列号（Sequence Number）：占 32 位。它表示本报文段所发送数据的第一个字节的编号。在 TCP 连接中，所传送的字节流的每一个字节都会按顺序编号。当SYN标记不为1时，这是当前数据分段第一个字母的序列号；如果SYN的值是1时，这个字段的值就是初始序列值（ISN），用于对序列号进行同步。这时，第一个字节的序列号比这个字段的值大1，也就是ISN加1。</p>
<ul>
<li>确认号字段</li>
</ul>
<p>TCP 确认号（Acknowledgment Number，ACK Number）：占 32 位。它表示接收方期望收到发送方下一个报文段的第一个字节数据的编号。其值是接收计算机即将接收到的下一个序列号，也就是下一个接收到的字节的序列号加1。</p>
<ul>
<li>数据偏移字段</li>
</ul>
<p>TCP 首部长度（Header Length）：数据偏移是指数据段中的“数据”部分起始处距离 TCP 数据段起始处的字节偏移量，占 4 位。其实这里的“数据偏移”也是在确定 TCP 数据段头部分的长度，告诉接收端的应用程序，数据从何处开始。</p>
<ul>
<li>保留字段</li>
</ul>
<p>保留（Reserved）：占 4 位。为 TCP 将来的发展预留空间，目前必须全部为 0。</p>
<ul>
<li><p>标志位字段</p>
<ul>
<li>CWR（Congestion Window Reduce）：拥塞窗口减少标志，用来表明它接收到了设置 ECE 标志的 TCP 包。并且，发送方收到消息之后，通过减小发送窗口的大小来降低发送速率。</li>
<li>ECE（ECN Echo）：用来在 TCP 三次握手时表明一个 TCP 端是具备 ECN 功能的。在数据传输过程中，它也用来表明接收到的 TCP 包的 IP 头部的 ECN 被设置为 11，即网络线路拥堵。</li>
<li>URG（Urgent）：表示本报文段中发送的数据是否包含紧急数据。URG=1 时表示有紧急数据。当 URG=1 时，后面的紧急指针字段才有效。</li>
<li>ACK：表示前面的确认号字段是否有效。ACK=1 时表示有效。只有当 ACK=1 时，前面的确认号字段才有效。TCP 规定，连接建立后，ACK 必须为 1。</li>
<li>PSH（Push）：告诉对方收到该报文段后是否立即把数据推送给上层。如果值为 1，表示应当立即把数据提交给上层，而不是缓存起来。</li>
<li>RST：表示是否重置连接。如果 RST=1，说明 TCP 连接出现了严重错误（如主机崩溃），必须释放连接，然后再重新建立连接。</li>
<li>SYN：在建立连接时使用，用来同步序号。当 SYN=1，ACK=0 时，表示这是一个请求建立连接的报文段；当 SYN=1，ACK=1 时，表示对方同意建立连接。SYN=1 时，说明这是一个请求建立连接或同意建立连接的报文。只有在前两次握手中 SYN 才为 1。</li>
<li>FIN：标记数据是否发送完毕。如果 FIN=1，表示数据已经发送完成，可以释放连接。</li>
</ul>
</li>
<li><p>窗口大小字段</p>
</li>
</ul>
<p>窗口大小（Window Size）：占 16 位。它表示从 Ack Number 开始还可以接收多少字节的数据量，也表示当前接收端的接收窗口还有多少剩余空间。该字段可以用于 TCP 的流量控制。</p>
<ul>
<li>TCP 校验和字段</li>
</ul>
<p>校验位（TCP Checksum）：占 16 位。它用于确认传输的数据是否有损坏。发送端基于数据内容校验生成一个数值，接收端根据接收的数据校验生成一个值。两个值必须相同，才能证明数据是有效的。如果两个值不同，则丢掉这个数据包。Checksum 是根据伪头 + TCP 头 + TCP 数据三部分进行计算的。</p>
<ul>
<li>紧急指针字段</li>
</ul>
<p>紧急指针（Urgent Pointer）：仅当前面的 URG 控制位为 1 时才有意义。它指出本数据段中为紧急数据的字节数，占 16 位。当所有紧急数据处理完后，TCP 就会告诉应用程序恢复到正常操作。即使当前窗口大小为 0，也是可以发送紧急数据的，因为紧急数据无须缓存。</p>
<ul>
<li>可选项字段</li>
</ul>
<p>选项（Option）：长度不定，但长度必须是 32bits 的整数倍。</p>
<h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><p>UDP数据段格式比较简单</p>
<p><img src="http://c.biancheng.net/uploads/allimg/191111/6-1911111249535K.gif" alt="img"></p>
<p>　　UDP数据报由首部和数据两部分组成，其中首部只有8字节。</p>
<p><strong>1、源端口号（Source Port）</strong></p>
<p>　　　　长度为16位，指明发送数据的进程。</p>
<p><strong>2、目的端口号（Destination Port）</strong></p>
<p>　　　　长度为16位，指明目的主机接收数据的进程。</p>
<p><strong>3、长度</strong></p>
<p>　　　　长度为16位，该字段值为报头和数据两部分的总字节数。</p>
<p><strong>4、检验和（Checksum）</strong></p>
<p>　　　　长度为16位，UDP检验和作用于UDP报头和UDP数据的所有位。由发送端计算和存储，由接收端校验。</p>
<p><strong>5、数据</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;bound method Ether.summary of </span><br><span class="line">&lt;Ether  dst=ff:ff:ff:ff:ff:ff src=ec:f0:fe:3c:39:28 type=IPv4 </span><br><span class="line"></span><br><span class="line">|&lt;IP  version=4 ihl=5 tos=0x0 len=237 id=44479 flags=DF frag=0 ttl=64 proto=udp chksum=0x7f0 src=192.168.1.1 dst=192.168.1.255</span><br><span class="line"></span><br><span class="line">|&lt;UDP  sport=netbios_dgm dport=netbios_dgm len=217 chksum=0xd60f </span><br><span class="line"></span><br><span class="line">|&lt;NBTDatagram  Type=17 Flags=10 ID=672 SourceIP=192.168.1.1 SourcePort=138 Length=195 Offset=0 SourceName=&#x27;SMBSHARE       &#x27; SUFFIX1=workstation NULL=0 DestinationName=&#x27;\x01\x02__MSBROWSE__\x02&#x27; SUFFIX2=16706 NULL=0 </span><br><span class="line"></span><br><span class="line">|&lt;Raw  load=&#x27;\xffSMB%\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11\x00\x00)\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00)\x00V\x00\x03\x00\x01\x00\x01\x00\x02\x00:\x00\\MAILSLOT\\BROWSE\x00\x0c\x03\x80\xfc\n\x00WORKGROUP\x00\x00\x00\x00\x00\x00\x00\x06\x01\x00\x10\x00\x80\x0f\x01U\xaaSMBSHARE\x00&#x27; |&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="IP报文格式"><a href="#IP报文格式" class="headerlink" title="IP报文格式"></a>IP报文格式</h2><p>IP数据包也叫IP报文分组，传输在ISO网络7层结构中的网络层，它由IP报文头和IP报文用户数据组成</p>
<blockquote>
<p>下图为IP分组的报文头格式，报文头的前20个字节是固定的，后面的可变。</p>
</blockquote>
<p><img src="http://c.biancheng.net/uploads/allimg/191106/6-191106153044K1.gif" alt="IP数据报格式示意图"></p>
<p>IP 报头的最小长度为 20 字节，上图中每个字段的含义如下：</p>
<ul>
<li>版本（version）</li>
</ul>
<p>占 4 位，表示 IP 协议的版本。通信双方使用的 IP 协议版本必须一致。目前广泛使用的IP协议版本号为 4，即 IPv4。</p>
<ul>
<li>首部长度（网际报头长度IHL）</li>
</ul>
<p>占 4 位，可表示的最大十进制数值是 15。这个字段所表示数的单位是 32 位字长（1 个 32 位字长是 4 字节）。因此，当 IP 的首部长度为 1111 时（即十进制的 15），首部长度就达到 60 字节。当 IP 分组的首部长度不是 4 字节的整数倍时，必须利用最后的填充字段加以填充。</p>
<p>数据部分永远在 4 字节的整数倍开始，这样在实现 IP 协议时较为方便。首部长度限制为 60 字节的缺点是，长度有时可能不够用，之所以限制长度为 60 字节，是希望用户尽量减少开销。最常用的首部长度就是 20 字节（即首部长度为 0101），这时不使用任何选项。</p>
<ul>
<li>区分服务（tos）</li>
</ul>
<p>也被称为服务类型，占 8 位，用来获得更好的服务。这个字段在旧标准中叫做服务类型，但实际上一直没有被使用过。1998 年 IETF 把这个字段改名为区分服务（Differentiated Services，DS）。只有在使用区分服务时，这个字段才起作用。</p>
<ul>
<li> 总长度（totlen）</li>
</ul>
<p>首部和数据之和，单位为字节。总长度字段为 16 位，因此数据报的最大长度为 2^16-1=65535 字节。</p>
<ul>
<li> 标识（identification）</li>
</ul>
<p>用来标识数据报，占 16 位。IP 协议在存储器中维持一个计数器。每产生一个数据报，计数器就加 1，并将此值赋给标识字段。当数据报的长度超过网络的 MTU，而必须分片时，这个标识字段的值就被复制到所有的数据报的标识字段中。具有相同的标识字段值的分片报文会被重组成原来的数据报。</p>
<ul>
<li>标志（flag）</li>
</ul>
<p>占 3 位。第一位未使用，其值为 0。第二位称为 DF（不分片），表示是否允许分片。取值为 0 时，表示允许分片；取值为 1 时，表示不允许分片。第三位称为 MF（更多分片），表示是否还有分片正在传输，设置为 0 时，表示没有更多分片需要发送，或数据报没有分片。</p>
<ul>
<li>片偏移（offsetfrag）</li>
</ul>
<p>占 13 位。当报文被分片后，该字段标记该分片在原报文中的相对位置。片偏移以 8 个字节为偏移单位。所以，除了最后一个分片，其他分片的偏移值都是 8 字节（64 位）的整数倍。</p>
<ul>
<li>生存时间（TTL）</li>
</ul>
<p>表示数据报在网络中的寿命，占 8 位。该字段由发出数据报的源主机设置。其目的是防止无法交付的数据报无限制地在网络中传输，从而消耗网络资源。</p>
<p>路由器在转发数据报之前，先把 TTL 值减 1。若 TTL 值减少到 0，则丢弃这个数据报，不再转发。因此，TTL 指明数据报在网络中最多可经过多少个路由器。TTL 的最大数值为 255。若把 TTL 的初始值设为 1，则表示这个数据报只能在本局域网中传送。 </p>
<ul>
<li>协议</li>
</ul>
<p>表示该数据报文所携带的数据所使用的协议类型，占 8 位。该字段可以方便目的主机的 IP 层知道按照什么协议来处理数据部分。不同的协议有专门不同的协议号。</p>
<p>例如，TCP 的协议号为 6，UDP 的协议号为 17，ICMP 的协议号为 1。</p>
<ul>
<li>首部检验和（checksum）</li>
</ul>
<p>用于校验数据报的首部，占 16 位。数据报每经过一个路由器，首部的字段都可能发生变化（如TTL），所以需要重新校验。而数据部分不发生变化，所以不用重新生成校验值。</p>
<ul>
<li>源地址</li>
</ul>
<p>表示数据报的源 IP 地址，占 32 位。</p>
<ul>
<li> 目的地址</li>
</ul>
<p>表示数据报的目的 IP 地址，占 32 位。该字段用于校验发送是否正确。</p>
<ul>
<li> 可选字段</li>
</ul>
<p>该字段用于一些可选的报头设置，主要用于测试、调试和安全的目的。这些选项包括严格源路由（数据报必须经过指定的路由）、网际时间戳（经过每个路由器时的时间戳记录）和安全限制。</p>
<ul>
<li> 填充</li>
</ul>
<p>由于可选字段中的长度不是固定的，使用若干个 0 填充该字段，可以保证整个报头的长度是 32 位的整数倍。</p>
<ul>
<li>数据部分</li>
</ul>
<p>表示传输层的数据，如保存 TCP、UDP、ICMP 或 IGMP 的数据。数据部分的长度不固定。</p>
<h2 id="ICMP-报文结构"><a href="#ICMP-报文结构" class="headerlink" title="ICMP 报文结构"></a>ICMP 报文结构</h2><p>ICMP 协议的数据包并不传输用户数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">数据包在发送到目标主机的过程中，通常会经过一个或多个路由器。而数据包在通过这些路由进行传输时，可能会遇到各种问题，导致数据包无法发送到目标主机上。为了了解数据包在传输的过程中在哪个环节出现了问题，就需要用到 ICMP 协议。它可以跟踪消息，把问题反馈给源主机。</span><br></pre></td></tr></table></figure>

<p>ICMP 报文一般为 8 个字节，包括类型、代码、校验和扩展内容字段。ICMP 报文基本结构如图所示。</p>
<p><img src="http://c.biancheng.net/uploads/allimg/191108/6-19110P93G0P6.gif" alt="img"></p>
<ul>
<li>类型表示 ICMP 的消息类型，</li>
<li>代码表示对类型的进一步说明，</li>
<li>校验和表示对整个报文的报文信息的校验</li>
<li>如果类型和代码不同，ICMP 数据包报告的消息含义也会不同。</li>
</ul>
<h2 id="ARP-报文格式"><a href="#ARP-报文格式" class="headerlink" title="ARP 报文格式"></a>ARP 报文格式</h2><blockquote>
<p>ARP 是“Address Resolution Protocol”的缩写，译为“地址解析协议”，它是根据 IP 地址获取物理地址的一个 TCP/IP 协议。</p>
</blockquote>
<p>ARP 协议是通过报文进行工作的，ARP 报文格式如图所示。</p>
<p><img src="http://c.biancheng.net/uploads/allimg/191106/6-1911061F551c3.gif" alt="img"></p>
<p>ARP 报文总长度为 28 字节，MAC 地址长度为 6 字节，IP 地址长度为 4 字节。</p>
<p>其中，每个字段的含义如下。</p>
<ul>
<li>硬件类型：指明了发送方想知道的硬件接口类型，以太网的值为 1。</li>
<li>协议类型：表示要映射的协议地址类型。它的值为 0x0800，表示 IP 地址。</li>
<li>硬件地址长度和协议长度：分别指出硬件地址和协议的长度，以字节为单位。对于以太网上 IP 地址的ARP请求或应答来说，它们的值分别为 6 和 4。</li>
<li>操作类型：用来表示这个报文的类型，ARP 请求为 1，ARP 响应为 2，RARP 请求为 3，RARP 响应为 4。</li>
<li>发送方 MAC 地址：发送方设备的硬件地址。</li>
<li>发送方 IP 地址：发送方设备的 IP 地址。</li>
<li>目标 MAC 地址：接收方设备的硬件地址。</li>
<li>目标 IP 地址：接收方设备的IP地址。</li>
</ul>
<h2 id="以太网帧"><a href="#以太网帧" class="headerlink" title="以太网帧"></a>以太网帧</h2><p>以太帧起始部分由前导码和帧开始符组成。</p>
<p>后面紧跟着一个以太网报头，以MAC地址说明目的地址和源地址。帧的中部是该帧负载的包含其他协议报头的数据包(例如IP协议)。</p>
<p>以太帧由一个32位冗余校验码结尾。它用于检验数据传输是否出现损坏。</p>
<p><img src="http://c.biancheng.net/uploads/allimg/191106/6-191106130541362.gif" alt="以太帧结构（格式）"></p>
<p>上图中每个字段的含义如下表所示：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>前同步码</td>
<td>用来使接收端的适配器在接收 MAC 帧时能够迅速调整时钟频率，使它和发送端的频率相同。前同步码为 7 个字节，1 和 0 交替。</td>
</tr>
<tr>
<td>帧开始定界符</td>
<td>帧的起始符，为 1 个字节。前 6 位 1 和 0 交替，最后的两个连续的 1 表示告诉接收端适配器：“帧信息要来了，准备接收”。</td>
</tr>
<tr>
<td>目的地址</td>
<td>接收帧的网络适配器的物理地址（MAC 地址），为 6 个字节（48 比特）。作用是当网卡接收到一个数据帧时，首先会检查该帧的目的地址，是否与当前适配器的物理地址相同，如果相同，就会进一步处理；如果不同，则直接丢弃。</td>
</tr>
<tr>
<td>源地址</td>
<td>发送帧的网络适配器的物理地址（MAC 地址），为 6 个字节（48 比特）。</td>
</tr>
<tr>
<td>类型</td>
<td>上层协议的类型。由于上层协议众多，所以在处理数据的时候必须设置该字段，标识数据交付哪个协议处理。例如，字段为 0x0800 时，表示将数据交付给 IP 协议。</td>
</tr>
<tr>
<td>数据</td>
<td>也称为效载荷，表示交付给上层的数据。以太网帧数据长度最小为 46 字节，最大为 1500 字节。如果不足 46 字节时，会填充到最小长度。最大值也叫最大传输单元（MTU）。  在 Linux 中，使用 ifconfig 命令可以查看该值，通常为 1500。</td>
</tr>
<tr>
<td>帧检验序列 FCS</td>
<td>检测该帧是否出现差错，占 4 个字节（32 比特）。发送方计算帧的循环冗余码校验（CRC）值，把这个值写到帧里。接收方计算机重新计算 CRC，与 FCS 字段的值进行比较。如果两个值不相同，则表示传输过程中发生了数据丢失或改变。这时，就需要重新传输这一帧。</td>
</tr>
</tbody></table>
<h2 id="802-11帧格式"><a href="#802-11帧格式" class="headerlink" title="802.11帧格式"></a>802.11帧格式</h2><p><img src="https://img-blog.csdn.net/20130712111619296?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTXlBcnJvdw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="img"></p>
<h3 id="MAC-Header（MAC头）"><a href="#MAC-Header（MAC头）" class="headerlink" title="MAC Header（MAC头）"></a>MAC Header（MAC头）</h3><p>   • Frame Control（帧控制域）</p>
<p>   • Duration/ID（持续时间/标识）</p>
<p>   • Address（地址域）</p>
<p>   • Sequence Control（序列控制域）</p>
<blockquote>
<p>Frame Control（帧控制域）</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">• Protocol Version（协议版本）：通常为0；</span><br><span class="line"> • Type（类型域）和Subtype（子类型域）：共同指出帧的类型；</span><br><span class="line"> • To DS：表明该帧是BSS向DS发送的帧；</span><br><span class="line"> • From DS：表明该帧是DS向BSS发送的帧；</span><br><span class="line"> • More Frag：用于说明长帧被分段的情况，是否还有其它的帧；</span><br><span class="line"> • Retry（重传域）：用于帧的重传，接收STA利用该域消除重传帧；</span><br><span class="line"> • Pwr Mgt（能量管理域）：1：STA处于power_save模式；0：处于active模式；</span><br><span class="line"> • More Data（更多数据域）：1：至少还有一个数据帧要发送给STA ；</span><br><span class="line"> • Protected Frame： 1：帧体部分包含被密钥套处理过的数据；否则：0；</span><br><span class="line"> • Order（序号域）：1：长帧分段传送采用严格编号方式；否则：0。</span><br></pre></td></tr></table></figure>



<blockquote>
<p> Duration/ID（持续时间/标识）</p>
</blockquote>
<p>   表明该帧和它的确认帧将会占用信道多长时间；对于帧控制域子类型为：Power Save-Poll的帧，该域表示了STA的连接身份（AID, Association Indentification）。</p>
<blockquote>
<p> Address（地址域）</p>
</blockquote>
<p>​    Address（地址域）：源地址（SA）、目的地址（DA）、传输工作站地址（TA）、接收工作站地址（RA），SA与DA必不可少，后两个只对跨BSS的通信有用，而目的地址可以为单播地址（Unicast address）、多播地址（Multicast address）、广播地址（Broadcast address）。</p>
<blockquote>
<p> Sequence Control（序列控制域）</p>
</blockquote>
<p>   Sequence Control（序列控制域）：由代表MSDU（MAC Server Data Unit）或者MMSDU（MAC Management Server Data Unit）的12位序列号（Sequence Number）和表示MSDU和MMSDU的每一个片段的编号的4位片段号组成（Fragment Number）。</p>
<h3 id="Frame-Body（帧体部分）"><a href="#Frame-Body（帧体部分）" class="headerlink" title="Frame Body（帧体部分）"></a><strong>Frame Body（帧体部分）</strong></h3><p>  包含信根据帧的类型有所不同，主要封装的是上层的数据单元，长度为0~2312个字节，可以推出，802.11帧最大长度为：2346个字节；</p>
<h3 id="FCS（校验域）"><a href="#FCS（校验域）" class="headerlink" title="FCS（校验域）"></a><strong>FCS（校验域）</strong></h3><p>  包含32位循环冗余码。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Daren</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://darenhsf.github.io/2019/11/13/%E6%95%B0%E6%8D%AE%E5%8C%85%E6%A0%BC%E5%BC%8F/">http://darenhsf.github.io/2019/11/13/%E6%95%B0%E6%8D%AE%E5%8C%85%E6%A0%BC%E5%BC%8F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://darenhsf.github.io" target="_blank">Angrily bullfighting</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/11/13/wifi%E5%9F%BA%E7%A1%80/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">wifi基础</div></div></a></div><div class="next-post pull-right"><a href="/2019/11/08/canary/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">canary</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Daren</div><div class="author-info__description">The gentleman is as gentle as his jade</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">91</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">网络数据封装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%84%E5%B1%82%E5%B0%81%E8%A3%85%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">各层封装格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP"><span class="toc-number">2.1.</span> <span class="toc-text">TCP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UDP"><span class="toc-number">2.2.</span> <span class="toc-text">UDP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">IP报文格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ICMP-%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84"><span class="toc-number">2.4.</span> <span class="toc-text">ICMP 报文结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARP-%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.5.</span> <span class="toc-text">ARP 报文格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7"><span class="toc-number">2.6.</span> <span class="toc-text">以太网帧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#802-11%E5%B8%A7%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.7.</span> <span class="toc-text">802.11帧格式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MAC-Header%EF%BC%88MAC%E5%A4%B4%EF%BC%89"><span class="toc-number">2.7.1.</span> <span class="toc-text">MAC Header（MAC头）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Frame-Body%EF%BC%88%E5%B8%A7%E4%BD%93%E9%83%A8%E5%88%86%EF%BC%89"><span class="toc-number">2.7.2.</span> <span class="toc-text">Frame Body（帧体部分）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FCS%EF%BC%88%E6%A0%A1%E9%AA%8C%E5%9F%9F%EF%BC%89"><span class="toc-number">2.7.3.</span> <span class="toc-text">FCS（校验域）</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/01/30/%E4%BD%BF%E7%94%A8wireshark%E6%8A%93%E5%8F%96ICMP%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/" title="使用wireshark抓取ICMP协议分析"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用wireshark抓取ICMP协议分析"/></a><div class="content"><a class="title" href="/2022/01/30/%E4%BD%BF%E7%94%A8wireshark%E6%8A%93%E5%8F%96ICMP%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/" title="使用wireshark抓取ICMP协议分析">使用wireshark抓取ICMP协议分析</a><time datetime="2022-01-30T03:31:28.000Z" title="发表于 2022-01-30 11:31:28">2022-01-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/25/icmp%E5%8D%8F%E8%AE%AE/" title="icmp协议"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="icmp协议"/></a><div class="content"><a class="title" href="/2022/01/25/icmp%E5%8D%8F%E8%AE%AE/" title="icmp协议">icmp协议</a><time datetime="2022-01-25T14:37:49.000Z" title="发表于 2022-01-25 22:37:49">2022-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/13/%E7%BD%91%E7%BB%9C%E9%A2%84%E8%AD%A6%E7%B3%BB%E7%BB%9F/" title="网络预警系统"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网络预警系统"/></a><div class="content"><a class="title" href="/2022/01/13/%E7%BD%91%E7%BB%9C%E9%A2%84%E8%AD%A6%E7%B3%BB%E7%BB%9F/" title="网络预警系统">网络预警系统</a><time datetime="2022-01-13T10:15:54.000Z" title="发表于 2022-01-13 18:15:54">2022-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/29/%E6%A0%88%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/" title="栈保护机制"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="栈保护机制"/></a><div class="content"><a class="title" href="/2021/11/29/%E6%A0%88%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/" title="栈保护机制">栈保护机制</a><time datetime="2021-11-29T14:20:31.000Z" title="发表于 2021-11-29 22:20:31">2021-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/16/%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B%E4%B9%8B%E5%B8%B8%E7%94%A8%E6%BC%8F%E6%B4%9E/" title="漏洞检测之常用漏洞"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="漏洞检测之常用漏洞"/></a><div class="content"><a class="title" href="/2021/11/16/%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B%E4%B9%8B%E5%B8%B8%E7%94%A8%E6%BC%8F%E6%B4%9E/" title="漏洞检测之常用漏洞">漏洞检测之常用漏洞</a><time datetime="2021-11-16T03:26:32.000Z" title="发表于 2021-11-16 11:26:32">2021-11-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Daren</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="20px" data-random="false" async="async"></script></div></body></html>